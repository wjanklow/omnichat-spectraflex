<!doctype html>
<html>
<body style="margin:0;font-family:sans-serif">
  <div id="log" style="height:90%;overflow:auto;padding:12px 16px 0;font-size:14px"></div>
  <form id="frm" style="display:flex;padding:8px 16px;border-top:1px solid #eee">
    <input id="msg" autocomplete="off"
           style="flex:1;border:1px solid #ccc;border-radius:6px;padding:6px 8px;font-size:14px"
           placeholder="Ask a questionâ€¦">
  </form>

  <script>
    const WS_URL = decodeURIComponent(
        new URLSearchParams(location.search).get("ws")
    );
    const ws  = new WebSocket(WS_URL);
    const log = document.getElementById("log");

    document.getElementById("frm").onsubmit = e => {
      e.preventDefault();
      const val = msg.value.trim();
      if (!val) return;
      ws.send(JSON.stringify({ message: val }));
      log.innerHTML += `<p style="color:#888;margin:4px 0">${val}</p>`;
      msg.value = "";
      log.scrollTop = log.scrollHeight;
    };

    ws.onmessage = e => {
      const d = JSON.parse(e.data);
      const safe = d.answer.replace(/[&<>]/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[m]));
      log.innerHTML += `<p style="margin:4px 0">${safe}</p>`;
      log.querySelectorAll("a").forEach(a => a.target = "_blank");
      log.scrollTop = log.scrollHeight;
    };
  </script>
</body>
</html>
